## 传统推荐系统方法

### 传统方法演进

* 协同过滤
* 矩阵分解
* 逻辑回归
* LS-PLM
* POLY2
* FM
* FFM
* GBDT+LR

### 协同过滤

* 协同过滤是协同大家的反馈意见对海量候选集进行过滤，从而筛选出目标用户感兴趣的物品。

* 协同过滤首先将用户反馈量化，构建一个M*N的共现矩阵，m为用户数，n为物品数，数值Xij表示用户i对物品j的反馈，这个值可以是直接反馈（评分、点赞）也可以是隐式反馈（点击次数，停留时间等）；共现矩阵中的行向量为用户向量，列向量表示物品向量。

* 构建共现矩阵后如何对海量物品进行过滤呢，这里有两种方法，一种是基于用户相似的userCF，另一种是基于物品相似的itemCF。

  * userCF
    * 基于用户的协同过滤主要思想是相似的用户喜好相同，由此可以向目标用户推荐相似用户喜欢的物品。通过共现矩阵可以得到每个用户的向量表示，由此就可以计算用户间的相似度，得到一个m*m的相似矩阵；
    * 在推荐的时候首先通过相似矩阵得到目标用户topN相似用户，然后通过相似值对物品的打分进行加权求和得到最终的推荐评分。

  * itemCF
    * 基于物品的协同过滤的思想是和用户喜欢的物品相似的其它物品也会引起用户的兴趣，因此可以根据目标用户历史行为中感兴趣的物品推荐相似的。通过共现矩阵可以得到每个物品的向量表示，由此可以计算物品间的相似度，得到一个n*n的相似矩阵；
    * 在推荐的时候首先通过目标用户的历史正反馈中选择topN的物品，然后通过正反馈的量化值对相似物品进行加权求和得到最终的推进评分。

  * 相似计算方法
    * 余弦相似
    * 修正用户打分偏差
    * 修正物品打分偏差

* 不管是userCF还是itemCF，都需要量化出共现矩阵，并由此计算出相似矩阵。协同过滤的一些缺陷就体现在这两个过程中。
  * 首先来看共现矩阵对userCF的影响，因为大多数用户只对少部分物品感兴趣，有交互历史数据的就更少了，因此共现矩阵是一个稀疏矩阵，这在行向量（用户向量）体现更突出，因此由此计算出的用户相似度准确度并不高；而且用户数M远大于物品数N，在推荐系统中需要维护一个M*M的相似矩阵其时间复杂度和空间复杂度都是n^2^。

  * 虽然共现矩阵的列向量(物品向量)同样会因为数据稀疏影响相似值得准确性，除此之外，因为物品流行度不同，很多热门物品会得到更多的正反馈，这会导致这些热门和很多物品的相似值都很高，更容易被推荐出去，相反那些小众物品因为正反馈较少而很难在推荐中占据上风，从而导致很强的头部相应；

  * 不管是用户相似矩阵还是物品相似矩阵都无法准确的体现出真实的用户关系或物品关系，除了共现矩阵比较稀疏的原因外另一个主要愿意是在计算量量相似的时候使用的是两个由历史交互数据构建的向量，但向量数据粒度过细且稀疏，数据中存在噪音影响大导致计算出的相似矩阵不够平滑，泛化能力弱。此外，CF在推荐过程中仅仅使用历史交互数据忽略了用户属性、物品属性、上下文信息等数据。

### 矩阵分解

* CF是基于相似来获取推荐评分的，但是由于共现矩阵的稀疏性、存在噪音等问题导致相似矩阵准确度并不高。矩阵分解在CF的基础上引入了隐向量的概念。矩阵分解和CF最大的区别是矩阵分解通过稀疏的共现矩阵将用户和物品同时映射到一个隐空间获取用户和物品的隐向量表示，直接计算二者在隐空间的距离进行推荐。

* 如何得到隐空间
  * 奇异值分解
    * 
    * 
  * 迭代优化
    * 先初始化用户和物品的隐向量，然后不断迭代优化，使得得到的用户隐向量$p$和物品隐向量$q$的內积尽可能的逼近已知的代表用户反馈的矩阵数值$r_{ui}$。因为用户和物品的打分都存在偏差，在迭代过程中需要对这些偏差进行修正。
    $$ \min_{p^*,q^*} \sum_{(u,i) \in K} (r_{ui}- \mu - b_u - b_i -q_i^Tp_u)^2 + \lambda(||q_i||^2+||p_u||^2+b_u^2 + b_i^2)$$
* 隐向量的生成过程就是对共现矩阵进行全局拟合的过程，因此隐向量利用了全局信息，能够学习users、items之间的传递关系，即使历史数据中两个物品没有相同的人同时和该物品交互，或则两个用户没有相同的交互行为，依然可以计算出他们之间的关系，因此矩阵分解方法具有更强的泛化能力。相对于CF，矩阵分解方法通过利用全局信息提高了泛化能力，避免了计算相似矩阵带来的空间开销，最终得到的用户和物品的隐向量应用更广泛。

* 虽然矩阵分解能够使用共现矩阵的全局信息，但依然无法使用用户属性、物品属性、上线文等信息

### 逻辑回归

* 通过逻辑回归不再基于相似进行推荐而是融合多路特征然后把推荐看作判断用户和物品是否发生正反馈交互的二分类问题。用户是否与物品发生正反馈行为是一个掷偏心硬币的问题，其中因变量服从伯努利分布，而逻辑回归是一个假设因变量服从伯努利分布的广义线性模型，因此可以通过逻辑回归拟合用户与物品发生正反馈的概率分布，然后使用该分布得到用户与每一个物品发生正反馈的概率，进而进行排序推荐。

* 逻辑回归首先对多种特征进行加权求和，然后将结果通过$sigmoid$函数映射到0~1之间从而得到发生正反馈的概率。

$$ \begin{array}{l}
  x = \begin{pmatrix} x_1 & x_2 & x_3 & ,,, & x_n \end{pmatrix} \\
  w = \begin{pmatrix} w_1 & w_2 & w_3 & ,,, & w_n \end{pmatrix} \\ \\
  f_w(x) = sigmoid = \frac{1}{1+e^{-(w^T*x+b)}} \\
\end{array}$$

* 逻辑回归最终目标是确定一组合适的参数$w$来拟合真实分布，但是由于真实分布无法是无法确定的，只能通过有限的样本来逼近真实分布，具体来说就是在模型拟合的分布下，使有限样本能够被观察到的概率最大化，通过这一标准估计参数的过程就是极大似然估计。

$$ \begin{array}{l}
  \begin{cases} P(y=1|{\bf{x;w}}) = f_x(x) \\ P(y=0|{\bf{x;w}}) = 1-f_w(x) \end{cases} \\ \\
  f(y|{\bf{x;w}}) = (f_w(x))^y(1-f_w(x))^{1-y} \\ \\
  L(W) = 
\end{array} $$







